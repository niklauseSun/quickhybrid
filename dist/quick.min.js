/*!
 * quickhybrid v0.0.1
 * (c) 2017-2021 dailc
 * Released under the BSD-3-Clause License.
 * https://github.com/quickhybrid/quickhybrid
 */
!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):e.quick=o()}(this,function(){"use strict";var o={ERROR_TYPE_APIOS:{code:1001,msg:"该API无法在当前OS下运行"},ERROR_TYPE_APIMODIFY:{code:1002,msg:"不允许更改JSSDK的API"},ERROR_TYPE_MODULEMODIFY:{code:1003,msg:"不允许更改JSSDK的模块"},ERROR_TYPE_APINOTEXIST:{code:1004,msg:"调用了不存在的api"},ERROR_TYPE_PROTONOTEXIST:{code:1005,msg:"调用错误，该组件api对应的proto不存在"},ERROR_TYPE_CUSTOMEAPINOTEXIST:{code:1006,msg:"非容器下无法调用自定义组件API"},ERROR_TYPE_EVENTNOTEXIST:{code:1007,msg:"对应的event事件在该环境下不存在"},ERROR_TYPE_INITVERSIONERROR:{code:1008,msg:"初始化版本号错误，请检查容器api的实现情况"},ERROR_TYPE_READYMODIFY:{code:2001,msg:"ready回调不允许多次设置"},ERROR_TYPE_CONFIGMODIFY:{code:2002,msg:"config不允许多次调用"},ERROR_TYPE_CONFIGERROR:{code:2003,msg:"config校验错误"},ERROR_TYPE_VERSIONNOTSUPPORT:{code:2004,msg:"不支持当前容器版本，请确保容器与前端库版本匹配"},ERROR_TYPE_VERSIONNEEDUPGRADE:{code:2005,msg:"当前JSSDK库小于容器版本，请将前端库升级到最新版本"},ERROR_TYPE_NATIVE:{code:3e3,msg:"捕获到一处原生容器错误"},ERROR_TYPE_NATIVECALL:{code:3001,msg:"原生调用H5时参数不对"},ERROR_TYPE_UNKNOWN:{code:9999,msg:"未知错误"}};function f(e){console.error("[hybridJs error]: "+e)}function d(e){console.log("[hybridJs log]: "+e)}function e(e){var e=e,n=void 0;e.showError=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"错误!";f("code:"+e+", msg:"+o),n&&n({code:e,message:o})},e.globalError=o,e.error=function(e){n=e}}function n(e){var o=e;window.JSBridge={};var e=window.JSBridge,i=o.showError,a=o.globalError,r=o.os;o.JSBridge=e;var s="QuickHybridJSBridge",c={},d={},u={},l=2147483647;function R(e,o){var n=s+"://"+e,t=void 0,r=void 0,e=void 0;return o.callbackId&&(t=o.callbackId,r=o.handlerName,e=o.data),n+=":"+t+"/"+r+"?"+(e=encodeURIComponent("string"!=typeof(r=e)?JSON.stringify(r):r))}function E(e,o,n){var t=o;"function"==typeof n?(o=Math.floor(Math.random()*l),d[o]=n,t.callbackId=o):t.callbackId=n;t=R(e,t);r.quick?r.ios?window.webkit.messageHandlers.WKWebViewJavascriptBridge.postMessage(t):window.top.prompt(t,""):f("浏览器中jsbridge无效,对应scheme:"+t)}e.registerHandler=function(e,o){c[e]=o},e.registerLongCallback=function(e,o){u[e]=o},e.getLongCallbackId=function(){return--l},e.callHandler=function(e,o,n,t){E(e,{handlerName:o,data:n},t)},e._handleMessageFromNative=function(r){setTimeout(function(){var e=void 0;try{e="string"==typeof r?(e=decodeURIComponent(r),JSON.parse(e)):r}catch(e){return void i(a.ERROR_TYPE_NATIVECALL.code,a.ERROR_TYPE_NATIVECALL.msg)}var o=e.responseId,n=e.responseData,t=void 0;o?((t=(t=d[o])||u[o])&&t(n),delete d[o]):(o=c[e.handlerName],e=e.data,o&&o(e))})}}function t(e){e=Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1];return"String"!==e&&"Number"!==e&&"Boolean"!==e&&"Undefined"!==e&&"Null"!==e}var c=function(){};function R(e){for(var n=e,o=arguments.length,t=Array(1<o?o-1:0),r=1;r<o;r++)t[r-1]=arguments[r];return t.forEach(function(o){Object.keys(o).forEach(function(e){n[e]=o[e]})}),n}function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:6,n=0;return e.split("").filter(function(e){return(n+=/[\u4e00-\u9fa5]/.test(e)?2:1)<=o}).join("")}function i(e){return/^(http|https|ftp|\/\/)/g.test(e)?e:/(\.\/)|(\.\.\/)/.test(e)?(r=e,n=window.location,o=n.pathname,t=(t=r.match(/\.\.\//g))&&t.length||0,t=(o=o.split("/")).slice(0,o.length-(t+1)).join("/"),r=r.replace(/\.+\//g,""),n.protocol+"//"+n.host+(t+"/"+r)):""+(n=window.location,t=n.pathname.split("/"),r=2<t.length,r=t[Number(r)]+"/",(n.protocol+"//"+n.host+"/"+r).replace(/[/]{2}$/,"/"))+e;var o,n,t,r}function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o=arguments[1],n=i(e),t="";return o&&Object.keys(o).forEach(function(e){-1===t.indexOf("?")&&-1===n.indexOf("?")?t+="?":t+="&",t+=e+"="+o[e]}),n+=t}function s(R){return function(e,o,n){function t(e){0===e.code?(i&&i(e),!d&&n&&n(e)):(e=e,a&&(e=a(e)),r&&r(e.result),!d&&o&&o(e.result))}var r=e.success,i=e.error,a=e.dataFilter,s=e.proto,c=e.handlerName,d=e.isLongCb,u=e.isEvent,l=e.data;d?(e=R.getLongCallbackId(),u&&(l.port=e),R.registerLongCallback(e,t),R.callHandler(s,c,l,e),o&&o()):R.callHandler(s,c,l,t)}}function u(e){var e=e,r=e.os,i=s(e.JSBridge);e.callInner=function(e,o,n){var t=R({},e);t.success=void 0,t.error=void 0,t.dataFilter=void 0,r.quick&&i({handlerName:this.api.namespace,data:t,proto:this.api.moduleName,success:e.success,error:e.error,dataFilter:e.dataFilter,isLongCb:this.api.isLongCb,isEvent:this.api.isEvent},o,n)}}function l(e){var d=e,u=d.Proxy,r=d.globalError,i=d.showError,a=d.os,l=d.callInner,R={},o={},E=["quick","dd","h5"];function f(e,o,n,t){Object.defineProperty(e,o,{configurable:!0,enumerable:!0,get:function(){var e=R[n],e=e[function(e){for(var o=0,n=E.length;o<n;o+=1)if(e[E[o]])return E[o];return"h5"}(a)]||e.h5;if(e)return e.walk();e=t.os?t.os.join("或"):'"非法"',e=t.namespace+"要求的os环境为:"+e;return i(r.ERROR_TYPE_APIOS.code,e),c},set:function(){i(r.ERROR_TYPE_APIMODIFY.code,r.ERROR_TYPE_APIMODIFY.msg)}})}function g(e){Object.defineProperty(d,e,{configurable:!0,enumerable:!0,get:function(){return o[e]||(o[e]={}),o[e]},set:function(){i(r.ERROR_TYPE_MODULEMODIFY.code,r.ERROR_TYPE_MODULEMODIFY.msg)}})}function s(e,o){var n,t,r,i,a,s,c;o&&o.namespace&&(d[e]||g(e),t=d[e],o=(n=o).namespace,n.moduleName=e,r=t,(/[.]/.test(t=o)?t.replace(/[.][^.]+$/,"").split("."):[]).forEach(function(e){r[e]=r[e]||{},r=r[e]}),t=r,i=e+"."+n.namespace,o=/[.]/.test(o)?n.namespace.match(/[.][^.]+$/)[0].substr(1):o,R[i]||f(t,o,i,n),o=n.runCode,a=new u(n,o=!o&&l?l:o),s=R[i]||{},c={},R[i]={},E.forEach(function(e){n.os&&-1!==n.os.indexOf(e)?(R[i][e]=a,c[e]=!0):s[e]&&(R[i][e]=s[e],n.os&&n.os.push(e))}),Object.keys(c).forEach(function(e){s[e]&&s[e].dispose()}))}d.extendModule=function(e,o){if(o&&Array.isArray(o)){d[e]||g(e);for(var n=0,t=o.length;n<t;n+=1)s(e,o[n])}},d.extendApi=s}function E(e){var n=e,t=n.globalError,r=n.showError,e=n.JSBridge,i=void 0,a=!1,s=!1;function c(){n.runtime&&n.runtime.getQuickVersion?n.runtime.getQuickVersion({success:function(e){e=e.version;(function(e,o){if("string"!=typeof e||"string"!=typeof o)throw new Error("version need to be string type");for(var n=e.split("."),t=o.split("."),r=Math.max(n.length,t.length),i=0;i<r;i+=1){var a=n[i]||0,s=t[i]||0;if((s-=0)<(a-=0))return 1;if(a<s)return-1}return 0})(n.version,e)<0&&r(t.ERROR_TYPE_VERSIONNEEDUPGRADE.code,t.ERROR_TYPE_VERSIONNEEDUPGRADE.msg)},error:function(){r(t.ERROR_TYPE_INITVERSIONERROR.code,t.ERROR_TYPE_INITVERSIONERROR.msg)}}):r(t.ERROR_TYPE_VERSIONNOTSUPPORT.code,t.ERROR_TYPE_VERSIONNOTSUPPORT.msg)}n.config=function(e){var o;s?r(t.ERROR_TYPE_CONFIGMODIFY.code,t.ERROR_TYPE_CONFIGMODIFY.msg):(s=!0,o=function(){i?(d("ready!"),i()):a=!0},n.os.quick?(c(),n.auth.config(R({success:function(){o()},error:function(e){e=JSON.stringify(e);r(t.ERROR_TYPE_CONFIGERROR.code,e)}},e||{}))):o())},n.ready=function(e){i?r(t.ERROR_TYPE_READYMODIFY.code,t.ERROR_TYPE_READYMODIFY.msg):(i=e,a&&(d("ready!"),a=!1,i()))},e.registerHandler("handleError",function(e){r(t.ERROR_TYPE_NATIVE.code,JSON.stringify(e))})}function g(e){var u=e,l={};(u.innerUtil=l).extend=R,l.isObject=t,l.getFullPath=i,l.getFullUrlByParams=a,l.eclipseText=r,l.compatibleStringParamsToObject=function(e){var o=this,n=e;if(!l.isObject(n[0])){for(var t={},r=!!u.getPromise(),e=n.length,i=r?e-2:e,a=arguments.length,s=Array(1<a?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];for(var d=0;d<i;d+=1)void 0!==s[d]&&(t[s[d]]=n[d]);n[0]=t,r?(n[1]=n[e-2],n[2]=n[e-1]):(n[1]=void 0,n[2]=void 0)}return this.api&&this.api.defaultParams&&n[0]instanceof Object&&Object.keys(this.api.defaultParams).forEach(function(e){void 0===n[0][e]&&(n[0][e]=o.api.defaultParams[e])}),n}}var O,h,m,p,P,v={};function _(e,o){this.api=e,this.callback=o}function T(e){var o=p.getPromise(),n=e||{},e=function(e,o){P({handlerName:n.name,proto:n.mudule,data:n.data||{},success:n.success,error:n.error,isLongCb:n.isLongCb,isEvent:n.isEvent},e,o)};return o&&new o(e)||e()}return function(e){this.os={};var o=e.match(/(Android);?[\s/]+([\d.]+)?/);o&&(this.os.android=!0,this.os.version=o[2],this.os.isBadAndroid=!/Chrome\/\d/.test(window.navigator.appVersion));o=e.match(/(iPhone\sOS)\s([\d_]+)/);o&&(this.os.ios=!0,this.os.iphone=!0,this.os.version=o[2].replace(/_/g,"."));o=e.match(/(iPad).*OS\s([\d_]+)/);o&&(this.os.ios=!0,this.os.ipad=!0,this.os.version=o[2].replace(/_/g,"."));o=e.match(/QuickHybrid/i);o&&(this.os.quick=!0);e=e.match(/DingTalk/i);e&&(this.os.dd=!0),e||o||(this.os.h5=!0)}.call(O=v,navigator.userAgent),(h=O).Promise=window.Promise,h.getPromise=function(){return h.Promise},h.setPromise=function(e){h.Promise=e},e(O),m=O,_.prototype.walk=function(){var i=this,a=m.getPromise();return function(){for(var e=arguments.length,o=Array(e),n=0;n<e;n++)o[n]=arguments[n];var t=o;t[0]=t[0]||{},i.api.defaultParams&&t[0]instanceof Object&&Object.keys(i.api.defaultParams).forEach(function(e){void 0===t[0][e]&&(t[0][e]=i.api.defaultParams[e])});var r=void 0;return i.callback&&(r=i.callback),a?r&&new a(function(e,o){t=t.concat([e,o]),r.apply(i,t)}):r&&r.apply(i,t)}},_.prototype.dispose=function(){this.api=null,this.callback=null},m.Proxy=_,n(O),u(O),l(O),P=s((p=O).JSBridge),p.callApi=T,p.callNativeApi=T,E(O),g(O),v.Version="1.0.0",v});